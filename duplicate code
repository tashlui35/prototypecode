#include <Servo.h>
#define second 1000
#define minute 60000
#define hour 3600000

Servo servo;
const int servoPin = 5;
const int servingsSizePin = A0;
const int numberofServingsPin = A1;
const int rotationTime = 2000; // Adjust this value based on your servo's speed for a full circle
int servingTime = 12555;
int servingDelta = 150;
int jerkPeriod = 700;
int feedingTimes = 0;
unsigned long lastFeeding = 0;

void setup ()
{
  Serial.begin(57600);
  pinMode(servingsSizePin, INPUT_PULLUP);
  pinMode(numberofServingsPin, INPUT_PULLUP);
  buzz();
}

void loop () 
{
  int sizeVal = digitalRead(servingsSizePin);
  if(sizeVal == 0){
    servingTime = 12555;
    delay(1000);
    buzz();
  }    

  if(sizeVal == 60){
    servingTime = 25110;
    delay(1000);
    buzz();
  }    
    
  if(sizeVal == 120){
    servingTime = 37665;
    delay(1000);
    buzz();
  }       
    
  if(sizeVal == 180){
    servingTime = 50220;
    delay(1000);
    buzz();
  }    
    
  int timesVal = digitalRead(numberofServingsPin);
  if(timesVal == LOW){
    if(millis() - lastFeeding > 24 * hour)
      dispense(servingTime);
    delay(10);
  }
  if(timesVal == HIGH){
    if(millis() - lastFeeding > 12 * hour)
      dispense(servingTime);
    delay(10);
  }
}

void dispense(int dispenseTime)
{
  lastFeeding = millis();
  for(; dispenseTime > 0; dispenseTime -= jerkPeriod){
    rotateFullCircle(rotationTime);
  }
}

void rotateFullCircle(int rotationTime)
{
  servo.attach(servoPin);
  servo.write(0); // Set the servo to rotate in one direction (0 or 180, depending on your servo)
  delay(rotationTime); // Adjust this delay to control the rotation time for a full circle
  servo.write(90); // Stop the servo by setting it to its neutral position (usually 90)
  servo.detach();
}

void buzz()
{
  rotateFullCircle(rotationTime);
  rotateFullCircle(rotationTime);
}
